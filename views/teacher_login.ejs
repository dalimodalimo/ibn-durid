<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† - Ù…Ø¯Ø±Ø³Ø© Ø§Ø¨Ù† Ø¯Ø±ÙŠØ¯</title>
    <link rel="stylesheet" href="/css/teacher_login.css">
    <style>
        /* Ø¥Ø®ÙØ§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
        .teacher-option { display: none; }
        .error { color: red; background: #fee; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="login-card">
    <h1>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h1>
    
    <% if (error) { %> 
        <div class="error"><%= error %></div> 
    <% } %>
    
    <form action="/teacher/login" method="POST">
        <label for="subject_filter">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
        <select id="subject_filter" onchange="filterTeachers()" required>
            <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>
            <% matieres.forEach(matiere => { %>
                <option value="<%= matiere.name %>"><%= matiere.name %></option>
            <% }) %>
        </select>

        <label for="teacher_id">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
        <select name="teacher_id" id="teacher_id" required disabled>
            <option value="" disabled selected id="default_teacher_opt">-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --</option>
            <% enseignants.forEach(prof => { %>
                <option value="<%= prof.id %>" class="teacher-option" data-subject="<%= prof.matiere %>">
                    <%= prof.nom %>
                </option>
            <% }) %>
        </select>

        <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
        <input type="password" name="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>

        <button type="submit">ÙØªØ­ Ø§Ù„Ø¬Ù„Ø³Ø© ğŸ”“</button>
    </form>

    <div class="footer-links">
        <a href="/admin/dashboard">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ø£Ø¯Ù…Ù†)</a>
    </div>
</div>

<script>
function filterTeachers() {
    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙˆØªÙ†Ø¸ÙŠÙÙ‡Ø§ Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
    const selectedSubject = document.getElementById('subject_filter').value.trim();
    const teacherSelect = document.getElementById('teacher_id');
    const options = document.querySelectorAll('.teacher-option');
    const defaultOpt = document.getElementById('default_teacher_opt');

    // 2. Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
    teacherSelect.value = "";
    let hasTeachers = false;

    // 3. Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø·Ø§Ø¨Ù‚Ø©
    options.forEach(opt => {
        const teacherSubject = opt.getAttribute('data-subject') ? opt.getAttribute('data-subject').trim() : "";

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© (Ù…Ø¹ ØªØ¬Ø§Ù‡Ù„ ÙØ±ÙˆÙ‚ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª)
        if (teacherSubject === selectedSubject && selectedSubject !== "") {
            opt.style.display = "block";
            hasTeachers = true;
        } else {
            opt.style.display = "none";
        }
    });

    // 4. ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    if (hasTeachers) {
        teacherSelect.disabled = false;
        defaultOpt.textContent = "-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --";
    } else {
        teacherSelect.disabled = true;
        defaultOpt.textContent = "âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ù„Ù…ÙˆÙ† Ù…Ø³Ø¬Ù„ÙˆÙ† Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©";
    }
}
</script>

</body>
</html>