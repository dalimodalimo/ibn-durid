<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titre %> - ูุฏุฑุณุฉ ุงุจู ุฏุฑูุฏ</title>
    <link rel="stylesheet" href="/css/teacher_style.css">  
</head>
<body>

<div class="container">
    
    <% if (success) { %>
        <div class="alert-success" style="background:var(--success); color:white; padding:15px; border-radius:10px; margin-bottom:20px; text-align:center;">
            โ ุชู ุฑุตุฏ ุงูุบูุงุจ ุจูุฌุงุญ ูุฅุฑุณุงูู ููุฅุฏุงุฑุฉ.
        </div>
    <% } %>

    <div class="header">
        <div>
            <h1>ุฃููุงูุ ุฃุณุชุงุฐ/ <%= prof.nom %> ๐</h1>
            <p>๐จโ๐ซ ุชุฎุตุต: <b><%= prof.matiere %></b> | ๐ ุงูููู: <b><%= today %></b></p>
        </div>
        <a href="/logout" class="btn-logout">ุชุณุฌูู ุงูุฎุฑูุฌ ๐ช</a>
    </div>

    <div class="section section-blue">
        <h2>๐ ุฌุฏูู ุญุตุต ุงูููู</h2>
        <div class="timetable-grid">
            <% if (sessions.length === 0) { %>
                <p>ูุง ููุฌุฏ ุญุตุต ูุณุฌูุฉ ูู ุงูููู.</p>
            <% } else { %>
                <% sessions.sort((a,b) => a.periode - b.periode).forEach(s => { %>
                    <div class="time-slot">
                        <b>ุงูุญุตุฉ <%= s.periode %></b>
                        <span><%= s.classe %> / <%= s.section %></span>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>

    <div class="section section-orange">
        <h2>๐ข ุชูุจููุงุช ุงูุฅุฏุงุฑุฉ (ุงูุบูุงุจ ูุงูุงุญุชูุงุท)</h2>
        <% if (replacements.length === 0) { %>
            <p>ุงููุถุน ูุณุชูุฑุ ูุง ุชูุฌุฏ ุบูุงุจุงุช ูููุนูููู ุงูููู.</p>
        <% } else { %>
            <div class="alerts-container">
                <% replacements.forEach(t => { %>
                    <div style="margin-bottom:12px; padding:15px; background:#fffcf0; border-radius:10px; border-right:5px solid var(--warning);">
                        โ๏ธ ุบูุงุจ: <b><%= t.nom %></b> (<%= t.matiere %>) - ุงูุณุจุจ: <%= t.raison %>
                    </div>
                <% }) %>
            </div>
        <% } %>
    </div>

    <div class="section section-green">
        <h2>๐ ุฑุตุฏ ุบูุงุจ ุงูุทูุงุจ</h2>
        <form action="/teacher/absences/mark" method="POST">
            <input type="hidden" name="teacher_id" value="<%= prof.id %>">
            <input type="hidden" name="date" value="<%= today %>">
            
            <div class="form-group">
                <label>ุงุฎุชุฑ ุงูุญุตุฉ ููุชุญ ุงููุดู:</label>
                <select name="periode" id="sessionSelect" required onchange="filterStudents()">
                    <option value="" disabled selected>-- ุงุฎุชุฑ ุงูุญุตุฉ ูู ุฌุฏููู --</option>
                    <% sessions.forEach(s => { %>
                        <option value="<%= s.periode %>" data-class="<%= s.classe %>-<%= s.section %>">
                            ุงูุญุตุฉ <%= s.periode %>: <%= s.classe %> / <%= s.section %>
                        </option>
                    <% }) %>
                </select>
            </div>

            <div id="tableWrapper" style="overflow-x: auto;">
                <table id="attendanceTable" style="display:none;">
                    <thead>
                        <tr>
                            <th>ุงุณู ุงูุทุงูุจ</th>
                            <th>ุงููุณู</th>
                            <th>ุงูุญุงูุฉ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% students.forEach(s => { %>
                            <tr class="student-row" data-class-id="<%= s.classe %>-<%= s.section %>">
                                <td><%= s.nom %></td>
                                <td><%= s.classe %> / <%= s.section %></td>
                                <td>
                                    <label class="badge-absent">
                                        <input type="checkbox" name="student_ids[]" value="<%= s.id %>"> ุชุณุฌูู ุบูุงุจ
                                    </label>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

            <button type="submit" id="submitBtn" style="display:none; margin-top:25px; width:100%; padding:15px; background:var(--success); color:white; border:none; border-radius:10px; cursor:pointer; font-size:1.1rem; font-weight:bold; box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);">ุญูุธ ูุฅุฑุณุงู ุงููุดู โ</button>
        </form>
    </div>

    <div class="section">
        <h2>โ๏ธ ุณุฌู ุงูููุงุญุธุงุช ุงูุณููููุฉ</h2>
        <form action="/teacher/behavior/add" method="POST" style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 15px; align-items: flex-end;">
            <input type="hidden" name="teacher_id" value="<%= prof.id %>">
            
            <div class="form-group">
                <label>ุงูุทุงูุจ:</label>
                <select name="student_id" required>
                    <option value="">-- ุงุฎุชุฑ ุงูุทุงูุจ --</option>
                    <% students.forEach(s => { %>
                        <option value="<%= s.id %>"><%= s.nom %> (<%= s.classe %> / <%= s.section %>)</option>
                    <% }) %>
                </select>
            </div>

            <div class="form-group">
                <label>ุงูููุงุญุธุฉ:</label>
                <input type="text" name="event_desc" placeholder="ูุซุงู: ุชููุฒ ูู ุญู ุงููุงุฌุจุ ุนุฏู ุฅุญุถุงุฑ ุงููุชุงุจ..." required>
            </div>

            <button type="submit" class="btn-save" style="background:var(--primary-dark); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-weight:bold; height: 45px;">ุญูุธ ๐พ</button>
        </form>
    </div>

</div>

<script>
    function filterStudents() {
        const select = document.getElementById('sessionSelect');
        const target = select.options[select.selectedIndex].getAttribute('data-class');
        const rows = document.querySelectorAll('.student-row');
        const table = document.getElementById('attendanceTable');
        const btn = document.getElementById('submitBtn');

        let count = 0;
        rows.forEach(row => {
            if (row.getAttribute('data-class-id') === target) {
                row.style.display = 'table-row';
                count++;
            } else {
                row.style.display = 'none';
            }
        });

        table.style.display = count > 0 ? 'table' : 'none';
        btn.style.display = count > 0 ? 'block' : 'none';
    }
</script>

</body>
</html>