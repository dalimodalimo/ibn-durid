<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>إدارة التقييمات الأكاديمية - مدرسة ابن دريد</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --purple: #8e44ad;
        }
        body { font-family: 'Cairo', sans-serif; background: #f4f7f6; padding: 40px; direction: rtl; }
        .container { max-width: 950px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); }
        
        .header-flex { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 25px; }
        h1 { color: var(--primary); margin: 0; font-size: 1.6rem; }

        /* الأزرار */
        .btn-add { background: var(--purple); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; font-weight: bold; transition: 0.3s; }
        .btn-add:hover { background: #7d3c98; transform: translateY(-2px); }
        
        .btn-view { background: var(--accent); color: white; padding: 7px 15px; border-radius: 6px; text-decoration: none; font-size: 0.9rem; transition: 0.3s; }
        .btn-view:hover { background: #2980b9; }

        /* الجدول */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: var(--primary); }

        /* النافذة المنبثقة (Modal) */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); }
        .modal-content { background: white; margin: 10% auto; padding: 30px; border-radius: 15px; width: 450px; position: relative; animation: slideDown 0.4s; }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .close { position: absolute; left: 20px; top: 15px; font-size: 24px; cursor: pointer; color: #999; }
        .form-group { margin-bottom: 20px; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: 'Cairo'; font-size: 1rem; }
        
        .submit-req { background: var(--success); color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; font-family: 'Cairo'; }

        .empty-state { text-align: center; padding: 50px; color: #95a5a6; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-flex">
        <h1><i class="fas fa-file-signature"></i> التقييمات الأكاديمية</h1>
        <button onclick="openModal()" class="btn-add">
            <i class="fas fa-plus-circle"></i> طلب تقييم جديد
        </button>
    </div>

    <table>
        <thead>
            <tr>
                <th>اسم الطالب</th>
                <th>الفصل الدراسي</th>
                <th>الإجراءات</th>
            </tr>
        </thead>
        <tbody>
            <% if(students && students.length > 0) { %>
                <% students.forEach(student => { %>
                <tr>
                    <td><strong><%= student.nom %></strong></td>
                    <td><%= student.classe %> / <%= student.section %></td>
                    <td>
                        <a href="/admin/student/full-report/<%= student.id %>" class="btn-view">
                            <i class="fas fa-eye"></i> عرض التقرير الشامل
                        </a>
                    </td>
                </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <td colspan="3" class="empty-state">
                        <i class="fas fa-folder-open" style="font-size: 3.5rem; display: block; margin-bottom: 15px; opacity: 0.5;"></i>
                        لا توجد تقارير مكتملة حالياً.<br>
                        اضغط على "طلب تقييم جديد" لبدء العملية.
                    </td>
                </tr>
            <% } %>
        </tbody>
    </table>

    <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 15px;">
        <a href="/admin/dashboard" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">
            <i class="fas fa-arrow-right"></i> العودة للوحة الإدارة
        </a>
    </div>
</div>

<div id="requestModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 style="margin-top:0; color: var(--primary);"><i class="fas fa-paper-plane"></i> إرسال طلب تقييم</h3>
        <p style="font-size: 0.9rem; color: #666;">سيتم إرسال تنبيه لجميع المدرسين المرتبطين بهذا الطالب.</p>
        
        <form action="/admin/students/request-evaluation" method="POST">
            <div class="form-group">
                <label style="display:block; margin-bottom:8px; font-weight:bold;">اختر الطالب:</label>
                <select name="student_id" required>
                    <option value="" disabled selected>ابحث عن الطالب...</option>
                    <% all_students.forEach(s => { %>
                        <option value="<%= s.id %>"><%= s.nom %> (<%= s.classe %>)</option>
                    <% }) %>
                </select>
            </div>
            <button type="submit" class="submit-req">تأكيد إرسال الطلب</button>
        </form>
    </div>
</div>

<script>
    function openModal() { document.getElementById('requestModal').style.display = 'block'; }
    function closeModal() { document.getElementById('requestModal').style.display = 'none'; }
    
    // إغلاق عند الضغط خارج النافذة
    window.onclick = function(event) {
        let modal = document.getElementById('requestModal');
        if (event.target == modal) closeModal();
    }
</script>

</body>
</html>