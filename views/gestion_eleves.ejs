<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titre %> - Ù…Ø¯Ø±Ø³Ø© Ø§Ø¨Ù† Ø¯Ø±ÙŠØ¯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/eleves_style.css">
    <style>
        /* Ø¥Ø¶Ø§ÙØ§Øª ØªÙ†Ø³ÙŠÙ‚ÙŠØ© Ù…Ø®ØµØµØ© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-right: 5px solid var(--accent-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }
        .stat-card i { font-size: 2rem; opacity: 0.2; }
        .stat-info h3 { margin: 0; font-size: 1.5rem; color: var(--primary-color); }
        .stat-info p { margin: 0; color: var(--text-muted); font-size: 0.9rem; }

        .search-bar-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .search-bar-container input { flex: 2; }
        .search-bar-container select { flex: 1; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-nav">
        <div>
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <p style="color: var(--text-muted); margin: 0;">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØªÙ†Ø¸ÙŠÙ… Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
        </div>
        <a href="/admin/dashboard" class="back-btn">
            <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
            <i class="fas fa-home"></i>
        </a>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <i class="fas fa-user-graduate"></i>
            <div class="stat-info">
                <h3><%= eleves.length %></h3>
                <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
            </div>
        </div>
        <div class="stat-card" style="border-right-color: var(--success-color);">
            <i class="fas fa-school"></i>
            <div class="stat-info">
                <h3><%= classes.length %></h3>
                <p>Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ</p>
            </div>
        </div>
    </div>

    <div class="section-card">
        <h2><i class="fas fa-plus-circle" style="color: var(--success-color);"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
        <form action="/admin/eleves/ajouter" method="POST" class="student-form">
            <div class="input-field">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨</label>
                <input type="text" name="nom" id="student_name_input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡" required>
            </div>
            
            <div class="input-field">
                <label>Ø§Ù„ØµÙ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø©</label>
                <select name="class_info" required>
                    <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¬Ù‡Ø© --</option>
                    <% classes.forEach(c => { %>
                        <% for(let i=1; i <= c.num_sections; i++) { %>
                            <option value="<%= c.class_name %>|<%= i %>">
                                <%= c.class_name %> - Ø´Ø¹Ø¨Ø© <%= i %>
                            </option>
                        <% } %>
                    <% }) %>
                </select>
            </div>

            <button type="submit" class="btn-submit">
                <i class="fas fa-check-double"></i>
                <span>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span>
            </button>
        </form>
    </div>

    <div class="section-card">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
            <h2 style="margin: 0;"><i class="fas fa-list-ul" style="color: var(--accent-color);"></i> Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
            
            <div class="search-bar-container">
                <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…...">
                <select id="classFilter" onchange="filterTable()">
                    <option value="">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option>
                    <% classes.forEach(c => { %>
                        <option value="<%= c.class_name %>"><%= c.class_name %></option>
                    <% }) %>
                </select>
            </div>
        </div>

        <div class="table-container">
            <table id="studentsTable">
                <thead>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                        <th>Ø§Ù„ØµÙ</th>
                        <th>Ø§Ù„Ø´Ø¹Ø¨Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (eleves.length === 0) { %>
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="fas fa-folder-open fa-3x" style="display: block; margin-bottom: 15px; opacity: 0.2;"></i>
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.
                            </td>
                        </tr>
                    <% } else { %>
                        <% eleves.forEach(student => { %>
                        <tr>
                            <td class="student-name"><%= student.nom %></td>
                            <td><span class="badge-class"><%= student.classe %></span></td>
                            <td><span style="font-weight: bold; color: var(--text-muted);">Ø§Ù„Ø´Ø¹Ø¨Ø© <%= student.section %></span></td>
                            <td>
                                <a href="/admin/eleves/supprimer/<%= student.id %>" 
                                   class="action-link" 
                                   style="color: var(--danger-color);"
                                   onclick="return confirm('Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ <%= student.nom %>ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')">
                                    <i class="fas fa-user-minus"></i> Ø­Ø°Ù
                                </a>
                            </td>
                        </tr>
                        <% }) %>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©
    function filterTable() {
        const searchText = document.getElementById('searchInput').value.toLowerCase();
        const classFilter = document.getElementById('classFilter').value;
        const table = document.getElementById('studentsTable');
        const rows = table.getElementsByTagName('tr');

        for (let i = 1; i < rows.length; i++) {
            const nameCell = rows[i].getElementsByTagName('td')[0];
            const classCell = rows[i].getElementsByTagName('td')[1];
            
            if (nameCell && classCell) {
                const nameText = nameCell.textContent.toLowerCase();
                const classText = classCell.textContent;
                
                const matchesSearch = nameText.includes(searchText);
                const matchesClass = classFilter === "" || classText === classFilter;

                if (matchesSearch && matchesClass) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }
    }
</script>

</body>
</html>