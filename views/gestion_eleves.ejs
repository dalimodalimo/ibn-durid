<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titre %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/settings_style.css">
    <link rel="stylesheet" href="/css/eleves_style.css">
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2><i class="fas fa-user-graduate"></i> ุดุคูู ุงูุทูุงุจ</h2>
    </div>

    <div class="sidebar-nav">
        <div class="nav-label">ุงูุฃุณุงุณูุงุช</div>
        <a href="/admin/dashboard"><i class="fas fa-home"></i> ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
        
        <div class="nav-label">ุงูุนูููุงุช</div>
        <a href="#section-stats"><i class="fas fa-chart-pie"></i> ุงูุฅุญุตุงุฆูุงุช</a>
        <a href="#section-add-student"><i class="fas fa-user-plus"></i> ุชุณุฌูู ุทุงูุจ</a>

        <div class="nav-label">ุงูุจูุงูุงุช</div>
        <a href="#section-list"><i class="fas fa-users"></i> ูุงุฆูุฉ ุงูุทูุงุจ</a>
        <a href="/admin/settings"><i class="fas fa-cog"></i> ุฅุนุฏุงุฏุงุช ุงููุธุงู</a>
    </div>
</div>

<div class="main-content">
    <header class="page-header">
        <h1><i class="fas fa-users"></i> ุฅุฏุงุฑุฉ ุณุฌูุงุช ุงูุทูุงุจ</h1>
    </header>

    <div class="stats-grid" id="section-stats">
        <div class="stat-card">
            <i class="fas fa-user-graduate"></i>
            <div class="stat-info">
                <h3><%= eleves.length %></h3>
                <p>ุฅุฌูุงูู ุงูุทูุงุจ</p>
            </div>
        </div>
        <div class="stat-card" style="border-right-color: #27ae60;">
            <i class="fas fa-school"></i>
            <div class="stat-info">
                <h3><%= classes.length %></h3>
                <p>ุนุฏุฏ ุงูุตููู</p>
            </div>
        </div>
    </div>

    <section class="card" id="section-add-student">
        <h3><i class="fas fa-plus-circle" style="color: #27ae60;"></i> ุชุณุฌูู ุทุงูุจ ุฌุฏูุฏ</h3>
        <form action="/admin/eleves/ajouter" method="POST" class="student-form-grid">
            <div class="input-group">
                <label>ุงูุงุณู ุงููุงูู ููุทุงูุจ</label>
                <input type="text" name="nom" placeholder="ุฃุฏุฎู ุงุณู ุงูุทุงูุจ ุฑุจุงุนู" required>
            </div>
            
            <div class="input-group">
                <label>ุงูุตู ูุงูุดุนุจุฉ</label>
                <select name="class_info" required>
                    <option value="" disabled selected>-- ุงุฎุชุฑ ุงููุฌูุฉ --</option>
                    <% classes.forEach(c => { %>
                        <% for(let i=1; i <= c.num_sections; i++) { %>
                            <option value="<%= c.class_name %>|<%= i %>">
                                <%= c.class_name %> - ุดุนุจุฉ <%= i %>
                            </option>
                        <% } %>
                    <% }) %>
                </select>
            </div>

            <button type="submit" class="btn btn-save" style="width: auto; margin-top: 25px;">
                <i class="fas fa-check-double"></i> ุชุฃููุฏ ุงูุชุณุฌูู
            </button>
        </form>
    </section>

    <section class="card" id="section-list">
        <div class="card-header-flex">
            <h3><i class="fas fa-list-ul"></i> ุณุฌู ุงูุทูุงุจ ุงูููููุฏูู</h3>
            
            <div class="filter-tools">
                <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="๐ ุงุจุญุซ ุจุงูุงุณู...">
                <select id="classFilter" onchange="filterTable()">
                    <option value="">ูู ุงูุตููู</option>
                    <% classes.forEach(c => { %>
                        <option value="<%= c.class_name %>"><%= c.class_name %></option>
                    <% }) %>
                </select>
            </div>
        </div>

        <div class="table-responsive">
            <table id="studentsTable">
                <thead>
                    <tr>
                        <th>ุงุณู ุงูุทุงูุจ</th>
                        <th>ุงูุตู</th>
                        <th>ุงูุดุนุจุฉ</th>
                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (eleves.length === 0) { %>
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="fas fa-folder-open fa-3x"></i>
                                <p>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุณุฌูุฉ ุญุงููุงู.</p>
                            </td>
                        </tr>
                    <% } else { %>
                        <% eleves.forEach(student => { %>
                        <tr>
                            <td class="student-name"><%= student.nom %></td>
                            <td><span class="badge-blue"><%= student.classe %></span></td>
                            <td><span class="section-text">ุงูุดุนุจุฉ <%= student.section %></span></td>
                            <td>
                                <a href="/admin/eleves/supprimer/<%= student.id %>" 
                                   class="btn-delete-link" 
                                   onclick="return confirm('ุญุฐู ุงูุทุงูุจ <%= student.nom %>ุ')">
                                    <i class="fas fa-trash-alt"></i> ุญุฐู
                                </a>
                            </td>
                        </tr>
                        <% }) %>
                    <% } %>
                </tbody>
            </table>
        </div>
    </section>
</div>

<script>
    function filterTable() {
        const searchText = document.getElementById('searchInput').value.toLowerCase();
        const classFilter = document.getElementById('classFilter').value;
        const rows = document.querySelectorAll('#studentsTable tbody tr');

        rows.forEach(row => {
            const nameCell = row.cells[0];
            const classCell = row.cells[1];
            if (nameCell) {
                const nameText = nameCell.textContent.toLowerCase();
                const classText = classCell.textContent;
                const matchesSearch = nameText.includes(searchText);
                const matchesClass = classFilter === "" || classText === classFilter;
                row.style.display = (matchesSearch && matchesClass) ? "" : "none";
            }
        });
    }
</script>

</body>
</html>