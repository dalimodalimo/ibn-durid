<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titre %> - مدرسة ابن دريد</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/enseignants_style.css">
</head>
<body>

<div class="container">
    <header class="page-header">
        <h1>إدارة شؤون المعلمين</h1>
        <a href="/admin/dashboard" class="back-link">
            <span>لوحة التحكم</span>
            <i class="fas fa-home"></i>
        </a>
    </header>

    <section class="section-card">
        <h2><i class="fas fa-user-plus"></i> إضافة معلم جديد للنظام</h2>
        <form action="/admin/enseignants/ajouter" method="POST" class="form-grid">
            <div class="input-group">
                <label>اسم المعلم الكامل</label>
                <input type="text" name="nom" placeholder="أدخل اسم المعلم" required>
            </div>
            
            <div class="input-group">
                <label>المادة التخصصية</label>
                <select name="matiere" required>
                    <option value="" disabled selected>اختر المادة...</option>
                    <% subjects.forEach(sub => { %>
                        <option value="<%= sub.name %>"><%= sub.name %></option>
                    <% }) %>
                </select>
            </div>
            
            <div class="input-group">
                <label>رقم التواصل</label>
                <input type="text" name="phone" placeholder="0XXXXXXXXX">
            </div>

            <button type="submit" class="btn btn-add">
                <i class="fas fa-save"></i> حفظ البيانات
            </button>
        </form>
    </section>

    <section class="section-card">
        <h2><i class="fas fa-chalkboard-teacher"></i> إسناد الفصول والجداول</h2>
        
        <form action="/admin/enseignants/affecter" method="POST" class="form-grid" style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
            <div class="input-group">
                <label>اختيار المعلم</label>
                <select name="enseignant_id" required>
                    <option value="" disabled selected>اختر المعلم...</option>
                    <% enseignants.forEach(prof => { %>
                        <option value="<%= prof.id %>"><%= prof.nom %></option>
                    <% }) %>
                </select>
            </div>

            <div class="input-group">
                <label>الصف والشعبة</label>
                <select name="class_info" required>
                    <option value="" disabled selected>اختر الصف...</option>
                    <% classes.forEach(c => { %>
                        <% for(let i=1; i <= c.num_sections; i++) { %>
                            <option value="<%= c.class_name %>|<%= i %>">
                                صف: <%= c.class_name %> (شعبة <%= i %>)
                            </option>
                        <% } %>
                    <% }) %>
                </select>
            </div>

            <button type="submit" class="btn btn-assign">
                <i class="fas fa-link"></i> تأكيد الإسناد
            </button>
        </form>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>المعلم</th>
                        <th>التخصص</th>
                        <th>الهاتف</th>
                        <th>الفصول المسندة</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    <% enseignants.forEach(prof => { %>
                    <tr>
                        <td><b style="color: var(--primary-blue);"><%= prof.nom %></b></td>
                        <td><span class="badge-matiere"><%= prof.matiere %></span></td>
                        <td><code style="font-family: monospace;"><%= prof.phone_number || '---' %></code></td>
                        <td>
                            <% 
                               let profAff = affectations.filter(a => a.nom === prof.nom);
                               if(profAff.length > 0) { 
                                 profAff.forEach(aff => { %>
                                    <div class="tag-classe">
                                        <i class="fas fa-users-class" style="font-size: 0.7rem;"></i>
                                        <%= aff.classe %> / <%= aff.section %>
                                        <form action="/admin/enseignants/desaffecter" method="POST" style="display:inline;">
                                            <input type="hidden" name="id" value="<%= aff.id %>">
                                            <button type="submit" class="btn-remove-aff" title="إلغاء التعيين" onclick="return confirm('إلغاء تعيين هذا الفصل؟')">&times;</button>
                                        </form>
                                    </div>
                                 <% }) 
                               } else { %>
                                 <span style="color:#94a3b8; font-style: italic; font-size: 0.8rem;">لا توجد تكليفات</span>
                               <% } 
                            %>
                        </td>
                        <td>
                            <a href="/admin/enseignants/supprimer/<%= prof.id %>" class="btn-delete" onclick="return confirm('حذف المعلم وسجلاته نهائياً؟')">
                                <i class="fas fa-trash-alt"></i> حذف
                            </a>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </section>
</div>

</body>
</html>